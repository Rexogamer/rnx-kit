"use strict";(self.webpackChunk_rnx_kit_docsite=self.webpackChunk_rnx_kit_docsite||[]).push([[2052],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),p=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(n),m=a,h=c["".concat(s,".").concat(m)]||c[m]||d[m]||o;return n?r.createElement(h,i(i({ref:t},u),{},{components:n})):r.createElement(h,i({ref:t},u))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:a,i[1]=l;for(var p=2;p<o;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9874:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var r=n(7462),a=(n(7294),n(3905));const o={},i="react-native-lazy-index",l={unversionedId:"tools/react-native-lazy-index",id:"tools/react-native-lazy-index",title:"react-native-lazy-index",description:"react-native-lazy-index is a Hermes/RAM bundle friendly, bundle-time generated",source:"@site/docs/tools/react-native-lazy-index.md",sourceDirName:"tools",slug:"/tools/react-native-lazy-index",permalink:"/rnx-kit/docs/tools/react-native-lazy-index",draft:!1,editUrl:"https://github.com/microsoft/rnx-kit/tree/main/docsite/docs/tools/react-native-lazy-index.md",tags:[],version:"current",frontMatter:{},sidebar:"toolsSidebar",previous:{title:"react-native-host",permalink:"/rnx-kit/docs/tools/react-native-host"},next:{title:"third-party-notices",permalink:"/rnx-kit/docs/tools/third-party-notices"}},s={},p=[{value:"Installation",id:"installation",level:2},{value:"Usage",id:"usage",level:2},{value:"Why",id:"why",level:2},{value:"Contributing",id:"contributing",level:2}],u={toc:p},c="wrapper";function d(e){let{components:t,...n}=e;return(0,a.kt)(c,(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"react-native-lazy-index"},"react-native-lazy-index"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"react-native-lazy-index")," is a Hermes/RAM bundle friendly, bundle-time generated\n",(0,a.kt)("inlineCode",{parentName:"p"},"index.js"),". Improve your app startup time by only loading features you'll use on\ndemand."),(0,a.kt)("p",null,"For information on RAM bundles and inline requires, see\n",(0,a.kt)("a",{parentName:"p",href:"https://reactnative.dev/docs/ram-bundles-inline-requires"},"React Native Performance"),"."),(0,a.kt)("p",null,"If you use ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/callstack/haul"},"Haul"),", also take a look at their\n",(0,a.kt)("a",{parentName:"p",href:"https://github.com/callstack/haul/blob/2c68e97766f9f6c2632c46e40631bd7aaacdc75b/docs/CLI%20Commands.md#haul-ram-bundle"},"documentation"),"."),(0,a.kt)("h2",{id:"installation"},"Installation"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"npm install --save @rnx-kit/react-native-lazy-index\n")),(0,a.kt)("h2",{id:"usage"},"Usage"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"react-native-lazy-index")," uses\n",(0,a.kt)("a",{parentName:"p",href:"https://github.com/kentcdodds/babel-plugin-codegen#configure-with-babel"},(0,a.kt)("inlineCode",{parentName:"a"},"babel-plugin-codegen")),",\nso you'll need to configure Babel to include it. The recommended way is to add\nit to your ",(0,a.kt)("inlineCode",{parentName:"p"},".babelrc"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-diff"},' {\n   "presets": ["module:metro-react-native-babel-preset"],\n   "plugins": [\n+    "codegen"\n   ]\n }\n')),(0,a.kt)("p",null,"In your ",(0,a.kt)("inlineCode",{parentName:"p"},"index.js"),", import ",(0,a.kt)("inlineCode",{parentName:"p"},"@rnx-kit/react-native-lazy-index")," and pass to it the\nfeatures that should be lazy loaded. In the example below, we register four\nentry points:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'// @codegen\nmodule.exports = require("@rnx-kit/react-native-lazy-index")({\n  SomeFeature: "@awesome-app/some-feature",\n  "callable:AnotherFeature": "@awesome-app/another-feature",\n  YetAnotherFeature: "@awesome-app/yet-another-feature",\n  FinalFeature: "@awesome-app/final-feature",\n});\n')),(0,a.kt)("p",null,"By default, a call to ",(0,a.kt)("inlineCode",{parentName:"p"},"AppRegistry")," is generated using the key as the app key,\nand the value is the name of the module containing the app. If the key is\nprefixed with ",(0,a.kt)("inlineCode",{parentName:"p"},"callable:"),", a call to ",(0,a.kt)("inlineCode",{parentName:"p"},"BatchedBridge")," will be generated."),(0,a.kt)("p",null,"That's it!"),(0,a.kt)("h2",{id:"why"},"Why"),(0,a.kt)("p",null,"With a naive ",(0,a.kt)("inlineCode",{parentName:"p"},"index.js"),", all features will be loaded when your app starts and\nReact Native is initialized for the first time."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'import "@awesome-app/some-feature";\nimport "@awesome-app/another-feature";\nimport "@awesome-app/yet-another-feature";\nimport "@awesome-app/final-feature";\n')),(0,a.kt)("p",null,"By loading features on demand, we can improve app startup time."),(0,a.kt)("p",null,"With ",(0,a.kt)("inlineCode",{parentName:"p"},"react-native-lazy-index"),", we no longer load all features up front.\nInstead, ",(0,a.kt)("inlineCode",{parentName:"p"},"index.js")," wraps calls to ",(0,a.kt)("inlineCode",{parentName:"p"},"AppRegistry.registerComponent")," and\n",(0,a.kt)("inlineCode",{parentName:"p"},"BatchedBridge.registerCallableModule"),", deferring the import of a feature until\nit is used. Features that are never used, are never loaded."),(0,a.kt)("p",null,"When you import ",(0,a.kt)("inlineCode",{parentName:"p"},"react-native-lazy-index"),", something similar to below is\ngenerated:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'const { AppRegistry } = require("react-native");\nconst BatchedBridge = require("react-native/Libraries/BatchedBridge/BatchedBridge");\n\nAppRegistry.registerComponent("SomeFeature", () => {\n  // We\'ll import the module the first time "SomeFeature" is accessed.\n  require("@awesome-app/some-feature");\n  // "SomeFeature" is now overwritten and we can return the real component.\n  // Subsequent calls to "SomeFeature" will no longer go through this wrapper.\n  return AppRegistry.getRunnable("SomeFeature").componentProvider();\n});\n\nBatchedBridge.registerLazyCallableModule("AnotherFeature", () => {\n  // We\'ll import the module the first time "AnotherFeature" is accessed.\n  require("@awesome-app/another-feature");\n  // "AnotherFeature" is now overwritten and we can return the real component.\n  // Subsequent calls to "AnotherFeature" will no longer go through this\n  // wrapper.\n  return BatchedBridge.getCallableModule("AnotherFeature");\n});\n\nAppRegistry.registerComponent("YetAnotherFeature", () => {\n  // We\'ll import the module the first time "YetAnotherFeature" is accessed.\n  require("@awesome-app/yet-another-feature");\n  // "YetAnotherFeature" is now overwritten and we can return the real\n  // component. Subsequent calls to "YetAnotherFeature" will no longer go\n  // through this wrapper.\n  return AppRegistry.getRunnable("YetAnotherFeature").componentProvider();\n});\n\nAppRegistry.registerComponent("FinalFeature", () => {\n  // We\'ll import the module the first time "FinalFeature" is accessed.\n  require("@awesome-app/final-feature");\n  // "FinalFeature" is now overwritten and we can return the real component.\n  // Subsequent calls to "FinalFeature" will no longer go through this wrapper.\n  return AppRegistry.getRunnable("FinalFeature").componentProvider();\n});\n')),(0,a.kt)("h2",{id:"contributing"},"Contributing"),(0,a.kt)("p",null,"This project welcomes contributions and suggestions. Most contributions require\nyou to agree to a Contributor License Agreement (CLA) declaring that you have\nthe right to, and actually do, grant us the rights to use your contribution. For\ndetails, visit ",(0,a.kt)("a",{parentName:"p",href:"https://cla.opensource.microsoft.com"},"https://cla.opensource.microsoft.com"),"."),(0,a.kt)("p",null,"When you submit a pull request, a CLA bot will automatically determine whether\nyou need to provide a CLA and decorate the PR appropriately (e.g., status check,\ncomment). Simply follow the instructions provided by the bot. You will only need\nto do this once across all repos using our CLA."),(0,a.kt)("p",null,"This project has adopted the\n",(0,a.kt)("a",{parentName:"p",href:"https://opensource.microsoft.com/codeofconduct/"},"Microsoft Open Source Code of Conduct"),".\nFor more information see the\n",(0,a.kt)("a",{parentName:"p",href:"https://opensource.microsoft.com/codeofconduct/faq/"},"Code of Conduct FAQ")," or\ncontact ",(0,a.kt)("a",{parentName:"p",href:"mailto:opencode@microsoft.com"},"opencode@microsoft.com")," with any\nadditional questions or comments."))}d.isMDXComponent=!0}}]);